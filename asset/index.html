<html>
  <head>
    <title>SpeedKetchup</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" type="text/css" href="uplot.css">
    <script type="text/javascript" src="uplot.js"></script>
    <script type="text/javascript" src="data.js"></script>
  </head>
  <body style="margin: 0;">
    <img src="stain.jpg" style="position: absolute; left: 0px; top: 0px; z-index: -1;">
    <script type="text/javascript">
function getSize() {
    let h = Math.max(window.innerHeight / 2 - 100, 200);
    return {
	width: window.innerWidth,
	height: h,
    }
}
function initSpeedKetchup() {
    let mooSync = uPlot.sync("moo");
    const matchSyncKeys = (own, ext) => own == ext;

    const cursorOpts = {
	lock: true,
	sync: {
	    key: mooSync.key,
//	    setSeries: true,
	    match: [matchSyncKeys, matchSyncKeys],
	},
	y: false,
    };

    let axis = [
	{
            grid: {
                show: true,
                stroke: "rgba(0,0,0,0.2)",
                width: 1,
            },
	},
	{
            grid: {
                show: true,
                stroke: "rgba(0,0,0,0.2)",
                width: 1,
            },
	},
    ];
    let series = {
	points: {
	    show: false,
	    size: 5,
	    fill: "black",
	}
    };

    let d = [data[0], data[4], data[5]];
    let opts = {
	title: "Speed (Bandwidth)",
	...getSize(),
	cursor: cursorOpts,
	drawOrder: ["series", "axes"],
	series: [
	    {},
	    {
		label: "Download",
		value: (u, v) => (v == null ? d[1][d[1].length - 1] : v).toFixed(1) + "Mbps",
		fill: "rgba(255, 0, 0, 0.7)",
//		stroke: "red",
		...series,
	    },
	    {
		label: "Upload",
		value: (u, v) => (v == null ? d[2][d[2].length - 1] : v).toFixed(1) + "Mbps",
		fill: "rgba(0, 0, 255, 0.7)",
//		stroke: "blue",
		...series,
	    }
	],
	axes: axis,
    };
    let uplot = new uPlot(opts, d, document.body);

    let d2 = [data[0], data[2], data[3], data[1]];
    let opts2 = {
	title: "Ping (Latency)",
	...getSize(),
	cursor: cursorOpts,
	drawOrder: ["series", "axes"],
	series: [
	    {},
	    {
		label: "Latency While Downloading",
		value: (u, v) => (v == null ? d2[1][d2[1].length - 1] : v) + "ms",
		fill: "rgba(255, 0, 0, 0.1)",
		...series,
	    },
	    {
		label: "Latency While Uploading",
		value: (u, v) => (v == null ? d2[2][d2[2].length - 1] : v) + "ms",
		fill: "rgba(0, 0, 255, 0.1)",
		...series,
	    },
	    {
		label: "Latency When Idle",
		value: (u, v) => (v == null ? d2[3][d2[3].length - 1] : v) + "ms",
		fill: "rgba(50, 150, 50, 1)",
		...series,
	    },
	],
	axes: axis,
    };
    let uplot2 = new uPlot(opts2, d2, document.body);

    window.addEventListener("resize", e => {
	uplot.setSize(getSize());
	uplot2.setSize(getSize());
    });
}
window.onload = initSpeedKetchup;
    </script>
  </body>
</html>
